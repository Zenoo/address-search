"use strict";function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _iterableToArrayLimit(a,b){var c=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null!=c){var d,e,f=[],g=!0,h=!1;try{for(c=c.call(a);!(g=(d=c.next()).done)&&(f.push(d.value),!(b&&f.length===b));g=!0);}catch(a){h=!0,e=a}finally{try{g||null==c["return"]||c["return"]()}finally{if(h)throw e}}return f}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var AddressSearch=function(){function a(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},d=2<arguments.length?arguments[2]:void 0;_classCallCheck(this,a),this._input=b instanceof Element?b:document.querySelector(b),this._errors=[],this._input||this._errors.push("AddressSearch: "+("string"==typeof b?"The selector `"+b+"` didn't match any element.":"The element you provided was undefined")),this._input&&this._input.classList.contains("address-search-input")&&this._errors.push("AddressSearch: The element has already been initialized."),this._errors.length?this._errors.forEach(function(a){console.warn(a)}):(this.uniqueId=document.querySelectorAll(".address-search[data-unique-id]").length+1,this._fetchPredictions=new google.maps.places.AutocompleteService,this._fetchPlace=new google.maps.places.PlacesService(document.createElement("div")),this._token="",this._usedTokens=[],this._economizer={},this._lure=this._input.cloneNode(!0),this._onSelect=[],this._onPredict=[],this._onError=[],this._parameters=c,this._delay=d,this._lastKeypress=null,this._timeout=null,this._apiFields=["address_component","adr_address","alt_id","formatted_address","geometry","icon","id","name","business_status","photo","place_id","plus_code","scope","type","url","utc_offset_minutes","vicinity"],this.value={},this._components=Object.entries(this._parameters).reduce(function(a,b){var c=_slicedToArray(b,2),d=c[0],e=c[1],f=document.querySelector(e);return f?a[d]=f:console.warn("The selector `"+e+"` didn't match any element."),a},{}),this._generateToken(),this._build(),this._listen())}return _createClass(a,[{key:"_build",value:function _build(){var a=this;this._wrapper=document.createElement("div"),this._wrapper.classList.add("address-search"),this._wrapper.setAttribute("data-unique-id",this.uniqueId),this._input.parentNode.insertBefore(this._wrapper,this._input),this._typeahead=document.createElement("input"),this._typeahead.setAttribute("class",this._input.getAttribute("class")),this._typeahead.setAttribute("tabindex",-1),this._typeahead.classList.add("address-search-typeahead");var b=this._typeahead.cloneNode(!0);b.classList.add("lure"),this._wrapper.appendChild(b),this._wrapper.appendChild(this._typeahead),this._lure.classList.add("address-search-lure"),this._lure.setAttribute("tabindex",-1),this._wrapper.appendChild(this._lure),this._input.classList.add("address-search-input"),this._input.removeAttribute("id"),this._input.removeAttribute("name"),this._wrapper.appendChild(this._input),this._predictions=document.createElement("ul"),this._predictions.classList.add("address-search-predictions"),this._wrapper.appendChild(this._predictions),Object.values(this._components).forEach(function(b){var c=b.cloneNode(!0);c.removeAttribute("id"),c.removeAttribute("class"),c.removeAttribute("name"),c.classList.add("address-search-lure"),c.setAttribute("data-refer-to",a.uniqueId),c.setAttribute("tabindex",-1),b.parentNode.insertBefore(c,b)})}},{key:"_listen",value:function _listen(){var a=this;this._input.addEventListener("input",function(){if(clearTimeout(a._timeout),a._lure.value=a._input.value,!a._input.value.length)a._typeahead.value="",a._togglePredictions("off");else if(a._input.value=a._capitalize(a._input.value),a._lure.value=a._input.value,a._delay&&(a._typeahead.value=""),a._economizer[a._input.value]){a._predictions.innerHTML=a._economizer[a._input.value],a._typeahead.value=a._predictions.firstElementChild.getAttribute("data-place-description").startsWith(a._input.value)?a._predictions.firstElementChild.getAttribute("data-place-description"):"",a._togglePredictions("on");var b,c=_createForOfIteratorHelper(a._onPredict);try{for(c.s();!(b=c.n()).done;){var d=b.value;d.call(a,a._input.value,a._predictions)}}catch(a){c.e(a)}finally{c.f()}}else a._delay?a._timeout=setTimeout(function(){a._getPredictions()},a._delay):a._getPredictions();a.value={}}),this._input.addEventListener("keydown",function(b){var c=b.keyCode||b.which;(9==c||13==c)&&(b.preventDefault(),a._input.value.length?a._select(a._predictions.firstElementChild.getAttribute("data-place-id")):a._input.blur())}),this._input.addEventListener("blur",function(){0===Object.keys(a.value).length&&a.value.constructor===Object&&setTimeout(function(){a._input.value="",a._lure.value=a._input.value,a._typeahead.value="",a._togglePredictions("off")},1)}),this._predictions.addEventListener("mousedown",function(){a._predictions.classList.add("clicked")}),this._predictions.addEventListener("click",function(b){if(a._predictions.classList.remove("clicked"),b.target&&("LI"==b.target.nodeName||"SPAN"==b.target.nodeName)){var c=b.target.closest("li");a._select(c.getAttribute("data-place-id"))}})}},{key:"_getPredictions",value:function _getPredictions(){var a=this;this._fetchPredictions.getPlacePredictions({input:this._input.value,sessiontoken:this._token},function(b,c){if(a._resetPredictions(),c==google.maps.places.PlacesServiceStatus.OK){var d,e=_createForOfIteratorHelper(b);try{for(e.s();!(d=e.n()).done;){var f=d.value,g=document.createElement("li");g.setAttribute("data-place-id",f.place_id),g.setAttribute("data-place-description",a._capitalize(f.description).replace(/"/g,"'"));var j=document.createElement("span");if(j.innerText=f.structured_formatting.main_text,g.appendChild(j),f.structured_formatting.secondary_text){var k=document.createElement("span");k.innerText=f.structured_formatting.secondary_text,g.appendChild(k)}a._predictions.appendChild(g)}}catch(a){e.e(a)}finally{e.f()}a._economizer[a._input.value]=a._predictions.innerHTML,a._typeahead.value=a._capitalize(b[0].description.substring(0,b[0].matched_substrings[0].length))==a._input.value?a._capitalize(b[0].description):"",a._togglePredictions("on");var h,i=_createForOfIteratorHelper(a._onPredict);try{for(i.s();!(h=i.n()).done;){var l=h.value;l.call(a,a._input.value,a._predictions)}}catch(a){i.e(a)}finally{i.f()}}else if("ZERO_RESULTS"==c){var m=document.createElement("li");m.classList.add("empty-results"),m.innerText="No address found",a._predictions.appendChild(m),a._typeahead.value=""}else console.log(c)})}},{key:"_resetPredictions",value:function _resetPredictions(){this._predictions.innerHTML=""}},{key:"_togglePredictions",value:function _togglePredictions(a){a?"on"==a?this._predictions.classList.add("shown"):this._predictions.classList.remove("shown"):this._predictions.classList.toggle("shown")}},{key:"_capitalize",value:function _capitalize(a){return a.charAt(0).toUpperCase()+a.slice(1)}},{key:"_select",value:function _select(a){var b=this,c=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return new Promise(function(d,e){b._fetchPlace.getDetails({placeId:a,fields:b._apiFields,sessiontoken:b._token},function(a,f){if(f==google.maps.places.PlacesServiceStatus.OK){if(b._generateToken(),b._togglePredictions("off"),b._resetPredictions(),b.value=a,b._input.value=a.formatted_address,b._lure.value=b._input.value,b._typeahead.value="",Object.entries(b._components).forEach(function(a){var c=_slicedToArray(a,2),d=c[0],e=c[1],f=d.endsWith("_short")?b._getPlaceComponent(d.slice(0,-6),!0):b._getPlaceComponent(d);e.value=f,e.previousElementSibling.value=f,e.readOnly=!!e.value.length}),b._input.blur(),c){var g,h=_createForOfIteratorHelper(b._onSelect);try{for(h.s();!(g=h.n()).done;){var k=g.value;k.call(b,b.value)}}catch(a){h.e(a)}finally{h.f()}}d()}else{console.log(f);var i,j=_createForOfIteratorHelper(b._onError);try{for(j.s();!(i=j.n()).done;){var l=i.value;l.call(b,f)}}catch(a){j.e(a)}finally{j.f()}e(f)}})})}},{key:"_getPlaceComponent",value:function _getPlaceComponent(a,b){var c=this.value.address_components.filter(function(b){return b.types.includes(a)});return c.length?b?c[0].short_name:c[0].long_name:""}},{key:"_generateToken",value:function _generateToken(){for(var a=this._token;""==a||this._usedTokens.includes(a);)a=(Math.random()+1).toString(36).substring(7);this._token=newToken,this._usedTokens.push(this._token)}},{key:"onSelect",value:function onSelect(a){return this._errors.length||this._onSelect.push(a),this}},{key:"offSelect",value:function offSelect(){return this._errors.length||(this._onSelect=[]),this}},{key:"onPredict",value:function onPredict(a){return this._errors.length||this._onPredict.push(a),this}},{key:"offPredict",value:function offPredict(){return this._errors.length||(this._onPredict=[]),this}},{key:"onError",value:function onError(a){return this._errors.length||this._onError.push(a),this}},{key:"offError",value:function offError(){return this._errors.length||(this._onError=[]),this}},{key:"setValue",value:function setValue(a){var b=this,c=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._errors.length||("string"==typeof a?this._fetchPredictions.getPlacePredictions({input:a},function(a,d){if(d==google.maps.places.PlacesServiceStatus.OK){var g=a[0];b._select(g.place_id,c)}else{console.log(d);var e,f=_createForOfIteratorHelper(b._onError);try{for(f.s();!(e=f.n()).done;){var h=e.value;h.call(b,d)}}catch(a){f.e(a)}finally{f.f()}}}):(this.value=a,this._input.value=a.formatted_address,this._lure.value=this._input.value,this._typeahead.value=""))}},{key:"setPlace",value:function setPlace(a){var b=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this._errors.length?Promise.resolve():this._select(a,b)}},{key:"reset",value:function reset(){return this._errors.length||(this.value={},this._input.value="",this._lure.value="",this._typeahead.value=""),this}},{key:"refreshService",value:function refreshService(){return this._errors.length||(this._fetchPredictions=new google.maps.places.AutocompleteService,this._fetchPlace=new google.maps.places.PlacesService(document.createElement("div")),this._economizer={}),this}},{key:"useService",value:function useService(a){return this._errors.length||(this._fetchPredictions=a.maps.places.AutocompleteService(),this._fetchPlace=a.maps.places.PlacesService(document.createElement("div")),this._economizer={}),this}},{key:"setFields",value:function setFields(a){return this._apiFields=a,this}},{key:"destroy",value:function destroy(){if(!this._errors.length){this._lure.id&&this._input.setAttribute("id",this._lure.id),this._lure.getAttribute("name")&&this._input.setAttribute("name",this._lure.getAttribute("name")),this._input.parentNode.parentNode.insertBefore(this._input,this._wrapper),this._wrapper.remove(),this._input.classList.remove("address-search-input"),document.querySelectorAll(".address-search-lure[data-refer-to=\""+this.uniqueId+"\"]").forEach(function(a){return a.remove()});var a=this._input.cloneNode(!0);this._input.parentNode.replaceChild(a,this._input)}}}],[{key:"destroy",value:function destroy(a){var b=document.querySelector(a);if(b){var c=b.nextElementSibling;if(c&&c.matches(".address-search-input")){var d=c.closest(".address-search[data-unique-id]").getAttribute("data-unique-id");document.querySelectorAll(".address-search-lure[data-refer-to=\""+d+"\"]").forEach(function(a){return a.remove()}),b.id&&c.setAttribute("id",b.id),b.getAttribute("name")&&c.setAttribute("name",b.getAttribute("name")),c.parentNode.parentNode.insertBefore(c,c.parentNode),c.nextElementSibling.remove(),c.classList.remove("address-search-input");var e=c.cloneNode(!0);c.parentNode.replaceChild(e,c)}}}}]),a}();
